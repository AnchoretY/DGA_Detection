
## 题目二 逆水行舟之DGA逆向分析 - 阶段1
### 题目描述
&emsp;找出包含在给定域名列表中的100个DGA域名

### 题目分析
DGA域名有以下特点：  
&emsp;&emsp;DGA算法生成的域名**只有一部分会被注册用于通信，还有一部分不被使用。这部分不被使用的DGA域名没有被注册过，也不存在解析记录。被注册的DGA域名也会有很少的解析记录**。  
&emsp;&emsp;基于算数的DGA算法是最常见的DGA算法，其特征是生成的域名看起来都是随机的字符串。  

### 冠军解题方法
1. **基于威胁情报的过滤**（过滤掉90%域名）
  - 过滤**Alexa top 1M中的域名**，这部分域名都是良性的域名（这部分还是存疑的，因为alexa 1m中还是存在污染域名的，这里追求完美应该使用VirusTotal进行验证）
  - 过滤**子域名过多的域名**。DGA域名一般不太会存在子域名，因此这里删除子域名数大于等于3的域名。
  - 过滤**域名解析记录数过多的域名**。DGA域名一般只会存在较短的时间，因此存在较少的域名解析记录，过滤存在过多域名解析记录的域名。域名解析记录条数大于等于3则认为是非DGA域名。

2. **基于分词的过滤**
  - 对域名进行**英文单词的分词**，若域名中含有长单词，则过滤此域名。
  - 对域名进行**汉语拼音的分词**，若域名中含有拼音，则过滤此域名。
  这里假设了没有使用字典生成的DGA域名，使用了检查点进行测试，发现假设成立。
> 上面已经使用的基于分词的过滤方法中，并**不能针对拼音简写类正常域名进行过滤**，例如http://hbjsjgyxgs.com 是一个正常的域名，是河北金属加工有限公司的首字母缩写。针对这种情况，可以从**拼音组成**的角度来考虑。对于绝大部分拼音来说，都是由声母和韵母组成。而**拼音的首字母缩写全部都是由声母组成（忽略那些没有声母的拼音）**，因此可以认为这种域名全部由声母组成。对中文常用词分析，**利用隐马尔可夫模型计算不同拼音首字母在中文词语中的转换概率（这里也可以直接统计声母占域名的比例）**。
3. **按照熵值进行排序**
  &emsp;&emsp;DGA域名随机性强，域名的熵值就会相对更大，因此按照熵值排序，取熵值最大的前100个域名。
4. **人工查验**

### 我的解决方案
1. **深度学习对DGA域名进行识别打分**  
&emsp;&emsp;使用netlab DGA数据作为黑样本，alexa 1m域名作为白域名使用GRU进行训练，得到200-400个恶意域名。

2. **过滤英文单词和汉语拼音**

3. **从域名字符统计特征等角度对域名进行聚类**  
&emsp;&emsp;使用聚类算法进行聚类，最终最接近100个类别即为同种DGA所生成的域名。

### 赛后分析
关于这道题目，我们解这道题目时，所犯的错误主要有三个：
  - 过分依赖于算法，第一步就使用GRU进行过滤，虽然在某些DGA家族上表现良好，但是在某些DGA家族上并不能具有很好的准确率，影响了后面的结果。
  - 对于DGA域名除字符特征以外的特点上分析不够，由于DGA的特殊用途，在子域名上、解析记录数上与正常域名的解析情况均具有比较显著的不同点。
  - 该题目出题方式并不是很严谨，题目描述中为使用同一种DGA生成算法100个域名，但是最终冠军的方案中并没有显示任何识别同一DGA生成的相关方法。
